---
title: "BST 210 PROJECT"
output:
  word_document: default
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r, warning = FALSE, message = FALSE}

#install.packages("splitstackshape")
#install.packages("gtools")
#install.packages("ResourceSelection")
#install.packages("LogisticDx")
#install.packages("ROCR")
#install.packages("ggplot2")
#install.packages("knitr")
#install.packages("ISLR")

library(tidyverse)
library(dplyr)
library(splines)
library(splines2)
library(ISLR)
library(gtools)
library(splitstackshape)
library(ResourceSelection)
library(LogisticDx)
library(ROCR)
library(ggplot2)

hiv <- read.csv(file ="data/hivstat.csv", header = TRUE, sep = ",")

baseline <- read.csv(file ="data/f00.csv", header = TRUE, sep = ",")

sociodemographic <-read.csv(file ="data/f01.csv", header = TRUE, sep =",")

medhistory <- read.csv(file = "data/hx_cleaned.csv", header = TRUE, sep = ",")

outcome <- read.csv(file = "data/outcome_cleaned.csv", header = TRUE, sep = ",")

alc_drugs <- read.csv(file = "data/f04.csv", header = TRUE, sep = ",")

join1 <- inner_join(hiv, baseline, by = "CASEID" )
join2 <- inner_join(join1, sociodemographic, by ="CASEID")
join3 <- inner_join(join2, medhistory, by = "CASEID")
join4 <- inner_join(join3, outcome, by = "CASEID")
join5 <- inner_join(join4, alc_drugs, by = "CASEID")
all <- join5

all <- all[, c("CASEID", "STATUS", "SPANSC", "AGE_SC", "RACESC", "EDUCSC", "MOMESC", "IDU_SC", "PARTSC", "FPOSSC", "COB_SD", "MAR_SD","NRESSD", "INC_SD","FMCNHX", "FMHBHX", "FMCLHX", "FMDBHX", "KDHXHX", "MAGEHX", "EVMIHX", "EVCFHX", "EVSTHX", "EVHCHX","EVLCHX", "EVLVHX", "EHRTHX", "OUTCAIDS", "OUTCCANC", "OUTCTB", "OUTCDTH", "EPOTBH", "EDTXBH", "SHARBH", "EVIDBH", "EVODBH", "EVHDBH", "EVJLBH", "MHIVBH", "MMANBH", "MVCDBH", "MEANBH", "FTOYBH", "ORNTBH")]

colnames(all) <- c("CASEID", "hivstat", "speak_spanish", "age", "ethnicity", "educ_level", "mother_educ", "drug", "sex_partners","first_pos_test", "birth_country", "marital_status", "living_with", "household_income", "family_cancer", "family_hbp", "family_cholesterol", "family_diabetes", "family_kidney" ," first_menstruation", "ever_mi", "ever_chf", "ever_stroke", "ever_highcholesterol", "ever_lung_clot", "ever_liverprob", "ever_hrt", "aids", "cancer", "tb", "death", "ever_marijuana", "ever_drug_treatment", "shared_needles", "ever_in_drug_detox", "ever_out_drug_detox", "ever_halfway_house", "ever_jail", "ever_sex_with_hiv_male", "ever_sex_with_gay_male", "condom_use", "ever_anal_sex", "ever_sex_toys", "sexual_orientation")

all$hivstat[all$hivstat == 4] <- 2
all$hivstat[all$hivstat == 1] <- 0
all$hivstat[all$hivstat == 2] <- 1

CASEID <- all$CASEID
hivstat <- all$hivstat
speak_spanish <- all$speak_spanish
age <- all$age
ethnicity <- all$ethnicity
educ_level <- all$educ_level
mother_educ <- all$mother_educ
drug <- all$drug
sex_partners <- all$sex_partners
birth_country <- all$birth_country
marital_status <- all$marital_status
household_income <- all$household_income
family_cancer <- all$family_cancer
family_hbp <- all$family_hbp
family_cholesterol <- all$family_cholesterol
family_diabetes <- all$family_diabetes
first_menstruation <- all$first_menstruation
ever_hrt <- all$ever_hrt
aids <- all$aids
cancer <- all$cancer
tb <- all$tb
death <- all$death
first_pos_test <- all$first_pos_test
living_with <- all$living_with
family_kidney <- all$family_kidney
ever_mi <- all$ever_mi
ever_chf <-all$ever_chf
ever_stroke <- all$ever_stroke
ever_highcholesterol <- all$ever_highcholesterol
ever_lung_clot <- all$ever_lung_clot
ever_liverprob <- all$ever_liverprob
ever_marijuana <- all$ever_marijuana
ever_drug_treatment <- all$ever_drug_treatment
shared_needles <- all$shared_needles
ever_in_drug_detox <- all$ever_in_drug_detox
ever_out_drug_detox <- all$ever_out_drug_detox
ever_halfway_house <- all$ever_halfway_house
ever_jail <- all$ever_jail
ever_sex_with_hiv_male <- all$ever_sex_with_hiv_male
ever_sex_with_gay_male <- all$ever_sex_with_gay_male
condom_use <- all$condom_use
ever_anal_sex <- all$ever_anal_sex
ever_sex_toys <- all$ever_sex_toys
sexual_orientation <-all$sexual_orientation



```
HIV STATUS: 
0: Negative
1: Prevalent 

```{r}
all %>% ggplot()+
  geom_boxplot(aes(factor(hivstat), age))+
  labs(x = "HIV Status", y = "Age")
```
We notice that there is no significant different in the ages of those with HIV infection compared to those without HIV

```{r}

all %>% 
  ggplot(aes(x = factor(hivstat), y = household_income)) +
  geom_boxplot()+
  labs(x = "HIV Status", y = "Household income")

```
There seems to be a little bit of a higher household income among those with HIV than those without HIV

```{r}

aids_proportion <- with(all, table(aids, hivstat)) %>% prop.table(margin = 2)
aids_proportion
```
Among those with HIV (hivstat = 1), only 29% have developed AIDS. This shows that HIV does not always lead to AIDS (contrarily to popular belief)

```{r}
partners_prop <- with(all, table(sex_partners, hivstat)) %>% prop.table(margin = 2)
partners_prop
```
The sex partner categories are as follows : 
1: 0 or no sex partners
2: 1 to 4 partners
3: 5 to 10 partners
4: 11 to 100 partners
5: more than 100 partners
-8 : don't know

We notice that for women with or without HIV status in this cohort, the number of sexual partners does not seem to change considerably.


```{r}
maritalstatus_prop <- with(all, table(marital_status, hivstat)) %>% prop.table(margin = 2)
maritalstatus_prop

```
The marital status categories are as follows: 
1: legally/common-law married
2: not married but living with partner
3: widowed 
4: divorced/annulled
5: separated
6: never married
7: other

We notice that among those with HIV, the biggest proportion has never been married. 
Also, there seems to be a significant bigger percentage of people who are widowed or divorced among the women with HIV than those without (will also see this in the summary of the logistic model below)
```{r}
glm_income <- glm(hivstat ~ I(household_income), data = all, family = binomial)
summary(glm_income)
```
At an alpha = 0.05 significance level, there seems to be a significant relationship between hiv status and household income. 

```{r}
glm_marital <- glm (hivstat ~ as.factor(marital_status) , data = all, family = binomial)
summary(glm_marital)
```
The odds of having HIV is significantly greater for women who are widowed or divorced than for women who are legally married.

```{r}
death_glm <- glm(death ~ ever_highcholesterol , family = binomial)
summary(death_glm)

```
Women who were ever told they had high cholesterol were more likely to die at the end of the study, compared with women who did not have high cholesterol. 


```{r}
glm_drug <- glm(hivstat ~ ever_drug_treatment, family = binomial)
summary(glm_drug)
```
At an alpha = 0.05 significance level, there seems to be a significant relationship between hiv status and receiving drug treatment. 



```{r}
death_logit = glm(death~ age, data = all , family = "binomial")
summary(death_logit)
exp(0.05201*10)
```
For every 10 year increase in age, the model predicts the odds of death to increase by a factor of 1.68
```{r}
hist1 = hist(all$age[all$death==1], plot = F, freq = F)
hist2 = hist(all$age[all$death==0], plot = F, freq = F)
plot( hist1, col=rgb(1,0,0,1/3), xlim=c(15,70), ylim = c(0,250), xlab = "age", main = "")  # first histogram
plot( hist2, col=rgb(0,0,1,1/4), xlim=c(15,70), add=T)  # second
lines(10:80,dnorm((10:80),mean = mean(all$age[all$death==1]), sd = sd(all$age[all$death==1]))*length(all$age[all$death==1])*5, col = rgb(1,0,0,2/3))
lines(10:80,dnorm((10:80),mean = mean(all$age[all$death==0]), sd = sd(all$age[all$death==0]))*length(all$age[all$death==0])*5, col = rgb(0,0,1,2/3))
```
As we can see in the plot of the histogram of women who died (red) and the histogram of the women who did not die (blue), the women who died were on average older than the women who did not die.

