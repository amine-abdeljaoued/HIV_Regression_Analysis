---
title: "BST 210 PROJECT"
output:
  word_document: default
  html_document: default
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r, warning = FALSE, message = FALSE}

#install.packages("splitstackshape")
#install.packages("gtools")
#install.packages("ResourceSelection")
#install.packages("LogisticDx")
#install.packages("ROCR")
#install.packages("ggplot2")
#install.packages("knitr")
#install.packages("ISLR")

library(tidyverse)
library(dplyr)
library(splines)
library(splines2)
library(ISLR)
library(gtools)
library(splitstackshape)
library(ResourceSelection)
library(LogisticDx)
library(ROCR)
library(ggplot2)
library(pROC)
library(nnet)

hiv <- read.csv(file ="data/hivstat.csv", header = TRUE, sep = ",")

baseline <- read.csv(file ="data/f00.csv", header = TRUE, sep = ",")

sociodemographic <-read.csv(file ="data/f01.csv", header = TRUE, sep =",")

medhistory <- read.csv(file = "data/hx_cleaned.csv", header = TRUE, sep = ",")

outcome <- read.csv(file = "data/outcome_cleaned.csv", header = TRUE, sep = ",")

alc_drugs <- read.csv(file = "data/f04.csv", header = TRUE, sep = ",")

all <- read.csv(file = "data/finaldataset.csv", header = TRUE, sep = ",")

View(all)


CASEID <- all$CASEID
hivstat <- all$hivstat
speak_spanish <- all$speak_spanish
age <- all$age
ethnicity <- all$ethnicity
educ_level <- all$educ_level
mother_educ <- all$mother_educ
drug <- all$drug
sex_partners <- all$sex_partners
birth_country <- all$birth_country
marital_status <- all$marital_status
household_income <- all$household_income
family_cancer <- all$family_cancer
family_hbp <- all$family_hbp
family_cholesterol <- all$family_cholesterol
family_diabetes <- all$family_diabetes
first_menstruation <- all$first_menstruation
ever_hrt <- all$ever_hrt
aids <- all$aids
cancer <- all$cancer
tb <- all$tb
death <- all$death
first_pos_test <- all$first_pos_test
living_with <- all$living_with
family_kidney <- all$family_kidney
ever_mi <- all$ever_mi
ever_chf <-all$ever_chf
ever_stroke <- all$ever_stroke
ever_highcholesterol <- all$ever_highcholesterol
ever_lung_clot <- all$ever_lung_clot
ever_liverprob <- all$ever_liverprob
ever_marijuana <- all$ever_marijuana
ever_drug_treatment <- all$ever_drug_treatment
shared_needles <- all$shared_needles
ever_in_drug_detox <- all$ever_in_drug_detox
ever_out_drug_detox <- all$ever_out_drug_detox
ever_halfway_house <- all$ever_halfway_house
ever_jail <- all$ever_jail
ever_sex_with_hiv_male <- all$ever_sex_with_hiv_male
ever_sex_with_gay_male <- all$ever_sex_with_gay_male
condom_use <- all$condom_use
ever_anal_sex <- all$ever_anal_sex
ever_sex_toys <- all$ever_sex_toys
sexual_orientation <-all$sexual_orientation
outcome_year <- all$outcomeyear



```
HIV STATUS: 
0: Negative
1: Prevalent 

```{r}
all %>% ggplot()+
  geom_boxplot(aes(factor(hivstat), age))+
  labs(x = "HIV Status", y = "Age")
```
We notice that there is no significant different in the ages of those with HIV infection compared to those without HIV

```{r}

all %>% 
  ggplot(aes(x = factor(hivstat), y = household_income)) +
  geom_boxplot()+
  labs(x = "HIV Status", y = "Household income")

```
There seems to be a little bit of a higher household income among those with HIV than those without HIV

```{r}

aids_proportion <- with(all, table(aids, hivstat)) %>% prop.table(margin = 2)
aids_proportion
```
Among those with HIV (hivstat = 1), only 29% have developed AIDS. This shows that HIV does not always lead to AIDS (contrarily to popular belief)

```{r}
partners_prop <- with(all, table(sex_partners, hivstat)) %>% prop.table(margin = 2)
partners_prop
```
The sex partner categories are as follows : 
1: 0 or no sex partners
2: 1 to 4 partners
3: 5 to 10 partners
4: 11 to 100 partners
5: more than 100 partners
-8 : don't know

We notice that for women with or without HIV status in this cohort, the number of sexual partners does not seem to change considerably.


```{r}
maritalstatus_prop <- with(all, table(marital_status, hivstat)) %>% prop.table(margin = 2)
maritalstatus_prop

```
The marital status categories are as follows: 
1: legally/common-law married
2: not married but living with partner
3: widowed 
4: divorced/annulled
5: separated
6: never married
7: other

We notice that among those with HIV, the biggest proportion has never been married. 
Also, there seems to be a significant bigger percentage of people who are widowed or divorced among the women with HIV than those without (will also see this in the summary of the logistic model below)
```{r}
glm_income <- glm(hivstat ~ I(household_income), data = all, family = binomial)
summary(glm_income)
```
At an alpha = 0.05 significance level, there seems to be a significant relationship between hiv status and household income. 

```{r}
glm_marital <- glm (hivstat ~ as.factor(marital_status) , data = all, family = binomial)
summary(glm_marital)
```
The odds of having HIV is significantly greater for women who are widowed or divorced than for women who are legally married.

```{r}
death_glm <- glm(death ~ ever_highcholesterol , family = binomial)
summary(death_glm)

```
Women who were ever told they had high cholesterol were more likely to die at the end of the study, compared with women who did not have high cholesterol. 


```{r}
glm_drug <- glm(hivstat ~ ever_drug_treatment, family = binomial)
summary(glm_drug)
```
At an alpha = 0.05 significance level, there seems to be a significant relationship between hiv status and receiving drug treatment. 



```{r}
death_logit = glm(death~ age, data = all , family = "binomial")
summary(death_logit)
exp(0.05201*10)
```
For every 10 year increase in age, the model predicts the odds of death to increase by a factor of 1.68
```{r}
hist1 = hist(all$age[all$death==1], plot = F, freq = F)
hist2 = hist(all$age[all$death==0], plot = F, freq = F)
plot( hist1, col=rgb(1,0,0,1/3), xlim=c(15,70), ylim = c(0,250), xlab = "age", main = "")  # first histogram
plot( hist2, col=rgb(0,0,1,1/4), xlim=c(15,70), add=T)  # second
lines(10:80,dnorm((10:80),mean = mean(all$age[all$death==1]), sd = sd(all$age[all$death==1]))*length(all$age[all$death==1])*5, col = rgb(1,0,0,2/3))
lines(10:80,dnorm((10:80),mean = mean(all$age[all$death==0]), sd = sd(all$age[all$death==0]))*length(all$age[all$death==0])*5, col = rgb(0,0,1,2/3))
```
As we can see in the plot of the histogram of women who died (red) and the histogram of the women who did not die (blue), the women who died were on average older than the women who did not die.


#############################################################################################

MODEL BUILDING: predicting HIV

```{r}
my_data <- matrix(c(hivstat, age, ethnicity, educ_level, marital_status, living_with, household_income, ever_marijuana, ever_drug_treatment, shared_needles, ever_in_drug_detox, ever_out_drug_detox, ever_halfway_house, ever_jail, ever_sex_with_hiv_male, ever_sex_with_gay_male, condom_use, ever_anal_sex, ever_sex_toys, sexual_orientation), ncol = 20)
cor(my_data, method = "pearson")

```
Based on the correlation matrix, there is a very high correlation between the following variables: ever_drug_treatment, ever_in_drug_detox, ever_out_drug_detox, ever_halfway_house, ever_jail. \
So, we will only include one of these variables in our analysis instead of including them all. 

Based on our research, we are interested in assessing the effects of ever being in jail with the incidence HIV. So, we are going to keep ever_jail in our analysis. 


After talking to Dr. Caitlin Dugdale, infectious disease physician with expertise in HIV research, we are going to construct a model predicting HIV status that includes the following predictors: ethnicity, drug injection, sex with hiv positive male, household income, number of sex partners, and history of incarceration. She believes that these variables are very important in predicting HIV status.

We will look at the association between hivstatus and each of these covariates alone.
```{r}
mod.ethnicity <- glm(hivstat ~ as.factor(ethnicity), data = all, family = binomial())

OR.ethnicity <- exp(coef(mod.ethnicity)[3]-coef(mod.ethnicity)[2])
OR.ethnicity
CI.ethnicity <- exp(log(OR.ethnicity) + c(-1,1)*1.96*sqrt(vcov(mod.ethnicity)[2,2] + vcov(mod.ethnicity)[3,3] - 2*vcov(mod.ethnicity)[2,3]))
CI.ethnicity
```

 The p-values might be insignificant because the reference group is the group whose responses were NA. But an important comparison that we can make here is between the people who are White and the people who are African American. The odds of having HIV among those who are African American is 1.67 times the odds of having HIV among those who are White on average. With 95% confidence, this odds ratio falls between 1.035 and 2.68. The confidence interval does not include 1, which shows that there is a significant difference between the odds of having HIV among the two groups.



```{r}
mod.druginjection <- glm(hivstat ~ as.factor(drug), data = all, family = binomial())
summary(mod.druginjection)

```
In our data there does not seem to be an association between HIV status and drug injection. However, we will still include it in our model because the domain experts told us that drug injection is an important confounder. 

```{r}

mod.hivmale <- glm(hivstat ~ as.factor(ever_sex_with_hiv_male), data = all, family = binomial())

OR.hivmale <- exp(coef(mod.hivmale)[2]-coef(mod.hivmale)[3])
OR.hivmale
CI.hivmale <- exp(log(OR.hivmale) + c(-1,1)*1.96*sqrt(vcov(mod.hivmale)[2,2] + vcov(mod.hivmale)[3,3] - 2*vcov(mod.hivmale)[2,3]))
CI.hivmale

```
The odds of having HIV among those who have had sex with an HIV positive male is 3.06 times the odds of having HIV among those who never had sex with an HIV positive male. With 95% confidence, this odds ratio falls between 2.08 and 4.51. The confidence interval does not include 1 which tells us that this odds ratio is statistically significant. 

```{r}
mod.income <- glm(hivstat ~ household_income, data = all, family = binomial())
summary(mod.income)

OR.income <- exp(coef(mod.income)[2])
OR.income
CI.income <- exp(log(OR.income) + c(-1,1)*1.96*sqrt(vcov(mod.income)[2,2]))
CI.income

```
There seems to be a significant association between a woman's household income and HIV status in the US. The odds of having HIV among women of a certain household income category is 1.14 times the odds of having HIV among women in 1 level lower household income category on average. With 95% confidence, this odds ratio falls between 1.06 and 1.24. This odds ratio is significant as it excludes 1. \
In our dataset, the results are counterintuitive because one would think that HIV status would negatively affect a woman's household income. But here, it seems that the women with higher household_incomes are more affected by HIV. 

```{r}
mod.sexpartners <- glm(hivstat ~ sex_partners, data = all, family = binomial())
summary(mod.sexpartners)

partners_prop <- with(all, table(sex_partners, hivstat)) %>% prop.table(margin = 2)
partners_prop

IRR.sexp <- exp(coef(mod.sexpartners)[2])
IRR.sexp
CI.sexp <- exp(log(IRR.sexp) + c(-1,1)*1.96*sqrt(vcov(mod.sexpartners)[2,2]))
CI.sexp


```
In our data, the number of sexual partners does not seem to affect one's HIV status, because the proportions of people with HIV and without HIV are the same for the different number of sexual partners. However, we might still include sexual partners in our model because it is a confounder and might provide a better fit for the model. \
The 95% confidence interval of the odds ratio comparing HIV incidence between people with a certain amount of sex partners versus a one level lower amount of sex partners contains 1. So this odds ratio isn't significant in our dataset. 

```{r}
mod.jail <- glm(hivstat ~ as.factor(ever_jail), data = all, family = binomial())
summary(mod.jail)

OR.jail <- exp(coef(mod.jail)[2]-coef(mod.hivmale)[3])
OR.jail
CI.jail<- exp(log(OR.jail) + c(-1,1)*1.96*sqrt(vcov(mod.jail)[2,2] + vcov(mod.jail)[3,3] - 2*vcov(mod.jail)[2,3]))
CI.jail

```
The odds of having HIV among the women who have ever been in jail is 2.12 times the odds of having HIV among those who have never been in jail on average. With 95% confidence, this odds ratio falls between 1.005 and 4.48. 



```{r}
new_model <- glm(hivstat ~ as.factor(ethnicity) + as.factor(drug) + as.factor(ever_sex_with_hiv_male) + household_income + sex_partners + as.factor(ever_jail), data = all, family = binomial())

hoslem.test(hivstat, fitted(new_model))

```


We used the Hosmer and Lemeshow goodness of fit test because we have a very large number of covariate patterns. \
We fail to reject the null hypothesis that the model provides a good fit (p-value = 0.85 > 0.05) and conclude that our model provides a good fit of the data. 

Looking at the ROC and AUC:


```{r}
predprob <- predict(new_model,type=c("response"))
roccurve <- roc(hivstat ~ predprob)
plot(roccurve,col="red")
auc(roccurve)

```
The AUC is smaller than 0.7 which is an indication that the model does not do good job in discriminating between cases and noncases.


BACKWARD SELECTION:

```{r}
start <- glm(hivstat ~ as.factor(ethnicity) + as.factor(educ_level) + as.factor(marital_status) + living_with + household_income + as.factor(drug) + sex_partners + as.factor(ever_marijuana) + as.factor(shared_needles) + as.factor(ever_jail) + as.factor(ever_sex_with_hiv_male) + as.factor(ever_sex_with_gay_male) + as.factor(condom_use) + as.factor(ever_anal_sex) + as.factor(ever_sex_toys) + as.factor(sexual_orientation) + age , family = binomial)

backwardModel <- step(start, direction = "backward")
```

The model that we get using backwards selection is:
```{r}

backward <- glm(hivstat ~ sex_partners + as.factor(ever_marijuana) + as.factor(ever_sex_toys) + household_income + as.factor(ever_sex_with_hiv_male) + as.factor(condom_use), data = all, family = binomial())
summary(backward)

hoslem.test(hivstat, fitted(backward))
```
We fail to reject the null hypothesis that the model provides a good fit (p-value = 0.36 > 0.05) and conclude that our model provides a good fit of the data. 
```{r}

predprob <- predict(backward,type=c("response"))
roccurve <- roc(hivstat ~ predprob)
plot(roccurve,col="red")
auc(roccurve)

```

The AUC for the backward model is 0.73 > 0.7 .This backward model does a better job at discriminating between cases and noncases than the previous model I created.

```{r}
start <- glm(hivstat ~ 1, family = binomial)
forwardModel <- step(start, direction = "forward", 
                     scope = (~ as.factor(ethnicity) + as.factor(educ_level) + as.factor(marital_status) + living_with + household_income + as.factor(drug) + sex_partners + as.factor(ever_marijuana) + as.factor(shared_needles) + as.factor(ever_jail) + as.factor(ever_sex_with_hiv_male) + as.factor(ever_sex_with_gay_male) + as.factor(condom_use) + as.factor(ever_anal_sex) + as.factor(ever_sex_toys) + as.factor(sexual_orientation) + age))


```
The model that we get using forward selection includes too many covariates. In our research we prefer simpler models, so we are going to stick to the backward model instead of the forward one. However, we are going to add drug injection to the backward model since it is an important confounder.

```{r}
backward_updated <- glm(hivstat ~ sex_partners + as.factor(drug) + as.factor(ever_marijuana) + as.factor(ever_sex_toys) + household_income + as.factor(ever_sex_with_hiv_male) + as.factor(condom_use), data = all, family = binomial())

hoslem.test(hivstat, fitted(backward_updated))

predprob <- predict(backward_updated,type=c("response"))
roccurve <- roc(hivstat ~ predprob)
plot(roccurve,col="red")
auc(roccurve)
```
Again we performed a Hosmer and Lemeshow goodness of fit test because we have a large number of covariates. The results point towards evidence of goodness of fit of our model (p-value = 0.41 > 0.05).

Also, the AUC is 0.73 > 0.7 which says that the model does a good job in discriminating between cases and noncases. 

```{r}
extractAIC(backward_updated)
extractAIC(backward)
extractAIC(new_model)

```
The model with the best AIC is the model that we got using backwards selection. However, there is a very small difference between the AIC of the backward model and the updated backward model where we included drug injection as a confounder. Clearly both of these models are better than the initial model we created in terms of AIC. \
For the following analyses, we are going to use the updated backward model.

```{r}
predprob1 <- predict(new_model,type=c("response"))
roccurve1 <- roc(hivstat ~ predprob1)

predprob3 <- predict(backward_updated,type=c("response"))
roccurve3 <- roc(hivstat ~ predprob3)

predprob2 <- predict(backward,type=c("response"))
roccurve2 <- roc(hivstat ~ predprob2)


library(ggplot2)
ggroc(list("Backward Updated" = roccurve3, "Backward" = roccurve2, "First attempt" = roccurve1))+ 
  theme(legend.title = element_blank()) +
  geom_segment(aes(x = 1, xend = 0, y = 0, yend = 1), color = "black", linetype = "dashed") +
  xlab("Sensitivity") +
  ylab("Specificity") +
  ggtitle("ROC curves")
```


Checking for outliers with Cook's Distance:

```{r}
cooksd <- cooks.distance(backward_updated)

no_outliers <- subset(all, cooksd <= 4/(nrow(all) - 2))

back_no_outliers <- glm(hivstat ~ sex_partners + as.factor(drug) + as.factor(ever_marijuana) + as.factor(ever_sex_toys) + household_income + as.factor(ever_sex_with_hiv_male) + as.factor(condom_use), data = no_outliers, family = binomial())

extractAIC(back_no_outliers)
```
The AIC of the model without the outliers is significantly lower than the AIC of the model including the outliers. This shows that in terms of goodness of fit, the model without the outliers performs significantly better than the model with the outliers.


Checking for points with high influence with DFFITS:

```{r}
dffits <- dffits(backward_updated)
no_highinfl <- subset(all, dffits <= 2*sqrt((6 + 1)/nrow(all)))

mod_no_highinfl <- glm(hivstat ~ sex_partners + as.factor(drug) + as.factor(ever_marijuana) + as.factor(ever_sex_toys) + household_income + as.factor(ever_sex_with_hiv_male) + as.factor(condom_use), data = no_highinfl, family = binomial())

extractAIC(mod_no_highinfl)
```
The AIC of the model without the highinfluence points is lower than the AIC of the model including these points. 


Removing the points with large Cook's Distance AND large DFFITS values : 

```{r}

without_all_outliers <- subset(all, cooksd <= 4/(nrow(all) - 2) &  dffits <= 2*sqrt((6 + 1)/nrow(all)))

mod_wo_all_outliers <- glm(hivstat ~ sex_partners + as.factor(drug) + as.factor(ever_marijuana) + as.factor(ever_sex_toys) + household_income + as.factor(ever_sex_with_hiv_male) + as.factor(condom_use), data = without_all_outliers, family = binomial())

extractAIC(mod_wo_all_outliers)

```
This model gives the smallest AIC so far, which makes sense because we are removing the outliers and high influence points, without which the model is a better fit. 

#############################################################################################

MODEL BUILDING: Predicting salary 

We want to understand what important factors define salaries in the women of the WIHS cohort. The point of this part is to build a good model predicting salaries based on the factors that we have. An emphasis is put on hiv_status first to analyze how it correlates with salaries.

To analyze multinomial models, we use the helper function provided in the lecture notes of Topic-9.

```{r}
# A function that will help us summarize multinomial models
summ.MNfit <- function(fit, digits=3){
s <- summary(fit)
for(i in 2:length(fit$lev))
{
##
cat("\nLevel", fit$lev[i], "vs. Level", fit$lev[1], "\n")
##
betaHat <- s$coefficients[(i-1),]
se <- s$standard.errors[(i-1),]
zStat <- betaHat / se
pval <- 2 * pnorm(abs(zStat), lower.tail=FALSE)
##
RRR <- exp(betaHat)
RRR.lower <- exp(betaHat - qnorm(0.975)*se)
RRR.upper <- exp(betaHat + qnorm(0.975)*se)
##
results <- cbind(betaHat, se, pval, RRR, RRR.lower, RRR.upper)
print(round(results, digits=digits))
}
}
```

Let us start with some exploratory data analysis.

```{r}
hist(household_income)
hist(marital_status)
```
There seems to be household_incomes concentrated around the low categories. Given that we know most of our patients are HIV positive, we can already start to think of a correlation. Looking at the marital_status distribution also gives important information. Most of the women of the cohort are either living with someone (1: legally/common-law married or 2: not married but living with partner ) or 6: never married. Category 6 is the most frequent one so we might also think that it plays a big role on the fact that household's incomes are relatively low in that cohort.


Let's firstly analyze how the household's income depends on women's marital status.

```{r}
mod1_multi = multinom(household_income ~ as.factor(marital_status) , data=all)
coef(mod1_multi)
```
```{r}
RRR1vs3_3 <- exp( coef(mod1_multi)[1,3]- coef(mod1_multi)[3,3] )

RRR1vs5_3 <- exp( coef(mod1_multi)[1,3]- coef(mod1_multi)[5,3] )

RRR1vs4_6 <- exp( coef(mod1_multi)[1,6]- coef(mod1_multi)[4,6] )


RRR1vs3_3
RRR1vs5_3
RRR1vs4_6
```
The relative risk ratio of being in household income category 1 (lowest) vs category 3 for widowed women is 1.39 that same risk for legally/common-law married women.

The relative risk ratio of being in household income category 1 (lowest) vs category 5 for widowed women is 1.76 that same risk for legally/common-law married women.

The relative risk ratio of being in household income category 1 (lowest) vs category 4 for never married women is 2.9 that same risk for legally/common-law married women.

Thus as we could have guessed, the probability of having a high household's income depends a lot on her marital situation. The risk ratio of having a low household income is higher for widowed/divorced women.

Let us see now how household income correlates with HIV status. We know that marital status can confound this association as it might be associated with the HIV status in the study base, is associated with household income independently on hiv status and is not a downstream consequence of neither of them. It would also very possibly be an effect modifier of this association. Indeed, it would be coherent to see the effect of hiv on household income vary according to the marital status (with a bigger association for women living alone for instance). Let us study that.

We firstly fit a model with hivstat alone.
```{r}
mod2_multi = multinom(household_income ~ as.factor(hivstat) , data=all)
coef(mod2_multi)
```
```{r}
RRR1vs8 <- exp(coef(mod2_multi)[1,2]-coef(mod2_multi)[8,2])
RRR1vs8
```
The relative risk ratio of being in household income category 1 (lowest) vs category 8 for HIV positive women is 2.74 that same risk as for non infected women.

Let us now try a model with both the marital_status and hiv_status.
```{r}
mod3_multi = multinom(household_income ~ as.factor(marital_status)+ as.factor(hivstat) , data=all)
summary(mod1_multi)
summary(mod2_multi)
summary(mod3_multi)
```
We can see that the lowest AICs are obtained when hivstat is used. We will now see if adding marital_status makes the model less significant.

```{r}
anova(mod2_multi,mod3_multi)
```
This test yields a significant p-value for the addition of marital_status. Therefore, we have a statistical evidence that marital_status does not confound the association of hiv_stat with household_income but is rather en effect modifier. This is coherent because as explained above: "it would be coherent to see the effect of hiv on household income vary according to the marital status (with a bigger association for women living alone for instance)."


Finally, we use other factors to see if we can get a better model: ethnicity, age, educ_level, birth_country, mother_educ, sexual_orientation,ever_jail. Let us start by doing some model selection to see which factors are the most significant here, before analyzing more in details their association with household_income.


```{r}
start <- multinom(household_income ~ as.factor(hivstat)+as.factor(marital_status) + as.factor(ethnicity)+ as.factor(age) + as.factor(educ_level) + as.factor(birth_country) +as.factor(mother_educ)+as.factor(sexual_orientation)+as.factor(ever_jail))

step(start, direction = "backward")
```


```{r}

start <- multinom(household_income~1)
step(start, direction = "forward", 
                     scope = (~ as.factor(hivstat)+as.factor(marital_status) + as.factor(ethnicity)+ as.factor(age) + as.factor(educ_level) + as.factor(birth_country) +as.factor(mother_educ)+as.factor(sexual_orientation)+as.factor(ever_jail)))
```

The model selection approaches seem to reveal that the following factors are the best ones: as.factor(hivstat) + as.factor(ethnicity) + as.factor(educ_level) + as.factor(ever_jail)


```{r}

mod4_multi <- multinom(household_income ~ as.factor(hivstat) + as.factor(ethnicity) + as.factor(educ_level) + as.factor(ever_jail) , data=all)
mod4_multi
```
The AIC is indeed better than when dealing with only hivstat and marital_status. We notice here than the latter was not considered as a good predictor. This is not contradictory because even though it gives more information on the association between hivstat and household_income, other factors might give better results when combined with hivstat. Here the chosen ones are:

Ethnicity: we know that in the US there is a statistical significance between ethnicity and socioeconomic status and thus salaries.
Education level: this is obvious that salaries are statistically associated with education levels.
Ever been to jail: reinsertion into the professional world after going to jail is very complicated in the US.

```{r}
all %>% 
  ggplot(aes(x = factor(educ_level), y = household_income)) +
  geom_boxplot()+
  labs(x = "Education level", y = "Household income")
```
For the education level, the pattern is quite clear: as the level of education increases the household income of a woman increases.

```{r}
all %>% 
  ggplot(aes(x = factor(ever_jail), y = household_income)) +
  geom_boxplot()+
  labs(x = "Ever been to jail", y = "Household income")
```

Ignoring -1 (missing data), we can see the household income tends to be much lower for category 1: yes.

Finally, let us give some relative risk ratio measures with our new factors:

```{r}
coef(mod4_multi)
```
```{r}
coef(mod4_multi)
```

```{r}
RRRf1 <- exp( coef(mod4_multi)[1,2]- coef(mod4_multi)[8,2] )
RRRf2 <- exp( coef(mod4_multi)[1,11]- coef(mod4_multi)[3,11] )
RRRf1
RRRf2
```
The relative risk ratio of being in household income category 1 (lowest) vs category 3 for african americans is 3.23 times that same risk for people who preferred to not declare their ethnicity.
The relative risk ratio of being in household income category 1 (lowest) vs category 3 for women who completed 4 years of college is 0.72 times that same risk for women with no schooling.
