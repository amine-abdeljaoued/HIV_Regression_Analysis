---
title: "BST 210 PROJECT"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r, warning = FALSE, message = FALSE}

#install.packages("splitstackshape")
#install.packages("gtools")
#install.packages("ResourceSelection")
#install.packages("LogisticDx")
#install.packages("ROCR")
#install.packages("ggplot2")
#install.packages("knitr")
#install.packages("ISLR")

library(tidyverse)
library(dplyr)
library(splines)
library(splines2)
library(ISLR)
library(gtools)
library(splitstackshape)
library(ResourceSelection)
library(LogisticDx)
library(ROCR)
library(ggplot2)

hiv <- read.csv(file ="data/hivstat.csv", header = TRUE, sep = ",")

baseline <- read.csv(file ="data/f00.csv", header = TRUE, sep = ",")

sociodemographic <-read.csv(file ="data/f01.csv", header = TRUE, sep =",")

physical <- read.csv(file = "data/height_and_weight.csv", header = TRUE, sep = ",")
colnames(physical)[2] <- "CASEID"

medhistory <- read.csv(file = "data/hx_cleaned.csv", header = TRUE, sep = ",")

outcome <- read.csv(file = "data/outcome_cleaned.csv", header = TRUE, sep = ",")

join1 <- inner_join(hiv, baseline, by = "CASEID" )
join2 <- inner_join(join1, sociodemographic, by ="CASEID")
join3 <- inner_join(join2, medhistory, by = "CASEID")
join4 <- inner_join(join3, outcome, by = "CASEID")
all <- inner_join(join4 , physical, by = "CASEID")

all <- all[, c("CASEID", "STATUS", "SPANSC", "AGE_SC", "RACESC", "EDUCSC", "MOMESC", "IDU_SC", "PARTSC", "FPOSSC", "COB_SD", "MAR_SD","NRESSD", "INC_SD","FMCNHX", "FMHBHX", "FMCLHX", "FMDBHX", "KDHXHX", "MAGEHX", "EVMIHX", "EVCFHX", "EVSTHX", "EVHCHX","EVLCHX", "EVLVHX", "EHRTHX", "OUTCAIDS", "OUTCCANC", "OUTCTB", "OUTCDTH", "height_cm", "weight_kg")]

colnames(all) <- c("CASEID", "hivstat", "speak_spanish", "age", "ethnicity", "educ_level", "mother_educ", "drug", "sex_partners","first_pos_test", "birth_country", "marital_status", "living_with", "household_income", "family_cancer", "family_hbp", "family_cholesterol", "family_diabetes", "family_kidney" ," first_menstruation", "ever_mi", "ever_chf", "ever_stroke", "ever_highcholesterol", "ever_lung_clot", "ever_liverprob", "ever_hrt", "aids", "cancer", "tb", "death", "height", "weight")


CASEID <- all$CASEID
hivstat <- all$hivstat
speak_spanish <- all$speak_spanish
age <- all$age
ethnicity <- all$ethnicity
educ_level <- all$educ_level
mother_educ <- all$mother_educ
drug <- all$drug
sex_partners <- all$sex_partners
birth_country <- all$birth_country
marital_status <- all$marital_status
household_income <- all$household_income
family_cancer <- all$family_cancer
family_hbp <- all$family_hbp
family_cholesterol <- all$family_cholesterol
family_diabetes <- all$family_diabetes
first_menstruation <- all$first_menstruation
ever_hrt <- all$ever_hrt
aids <- all$aids
cancer <- all$cancer
tb <- all$tb
death <- all$death
death
height <- all$height_cm
weight <- all$weight_kg
first_pos_test <- all$first_pos_test
living_with <- all$living_with
family_kidney <- all$family_kidney
ever_mi <- all$ever_mi
ever_chf <-all$ever_chf
ever_stroke <- all$ever_stroke
ever_highcholesterol <- all$ever_highcholesterol
ever_lung_clot <- all$ever_lung_clot
ever_liverprob <- all$ever_liverprob


all$bmi <- all$weight/(all$height/100)^2 
bmi <- all$bmi

all$hivstat[all$hivstat == 4] <- 2

```
HIV STATUS: 
1: Negative
2: Prevalent 

```{r}
all %>% ggplot()+
  geom_boxplot(aes(factor(hivstat), age))+
  labs(x = "HIV Status", y = "Age")
```
We notice that there is no significant different in the ages of those with HIV infection compared to those without HIV

```{r}

all %>% 
  ggplot(aes(x = factor(hivstat), y = household_income)) +
  geom_boxplot()+
  labs(x = "HIV Status", y = "Household income")

```
There seems to be a little bit of a higher household income among those with HIV than those without HIV

```{r}

aids_proportion <- with(all, table(aids, hivstat)) %>% prop.table(margin = 2)
aids_proportion
```
Among those with HIV (hivstat = 2), only 27% have developed AIDS. This shows that HIV does not always lead to AIDS.

```{r}
partners_prop <- with(all, table(sex_partners, hivstat)) %>% prop.table(margin = 1)
partners_prop
```
The sex partner categories are as follows : 
1: 0 or no sex partners
2: 1 to 4 partners
3: 5 to 10 partners
4: 11 to 100 partners
5: more than 100 partners
-8 : don't know

We notice that as the number of sex partners increases, the proportion of those with HIV increases as well. 
```{r}
library(ggplot2)
all %>% ggplot()+
  geom_boxplot(aes(factor(hivstat), bmi))+
  labs(x = "HIV Status", y = "BMI")

```
There seems to be no relationship between HIV status and BMI.


```{r}
maritalstatus_prop <- with(all, table(marital_status, hivstat)) %>% prop.table(margin = 2)
maritalstatus_prop

```
The marital status categories are as follows: 
1: legally/common-law married
2: not married but living with partner
3: widowed 
4: divorced/annulled
5: separated
6: never married
7: other

We notice that among those with HIV, the biggest proportion has never been married. 
Also, there seems to be a significant bigger percentage of people who are widowed or divorced among the women with HIV than those without (will also see this in the summary of the logistic model below)
```{r}

glm_income <- glm((hivstat - 1) ~ I(household_income), data = all, family = binomial)
summary(my_glm)
```
At an alpha = 0.05 significance level, there seems to be a significant relationship between hiv status and household income. 

```{r}

glm_partners <- glm((hivstat - 1) ~ I(sex_partners), data = all, family = binomial)
summary(glm_partners)
```
At an alpha = 0.06 significance level, there seems to be a significant relationship between hiv status and number of sex partners. 

```{r}
glm_marital <- glm ((hivstat - 1) ~ as.factor(marital_status) , data = all, family = binomial)
summary(glm_marital)
```
If we compare the women who are widowed or divorced, there is a bigger amount of women who are widowed or divorced among those with HIV than those without HIV. 


```{r}
death_glm <- glm(death ~ ever_highcholesterol , family = binomial)
summary(death_glm)

```
Women who were ever told they had high cholesterol were more likely to die at the end of the study. 